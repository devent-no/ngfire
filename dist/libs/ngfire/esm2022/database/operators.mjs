import { Observable } from 'rxjs';
import { delay } from 'rxjs/operators';
import { onValue } from 'firebase/database';
/**
 * Create an observable from a Database Reference or Database Query.
 * @param query Database Reference
 */
export function fromQuery(query) {
    return new Observable((subscriber) => {
        const unsubscribe = onValue(query, (snapshot) => subscriber.next(snapshot), subscriber.error.bind(subscriber));
        return { unsubscribe };
    }).pipe(
    // Ensures subscribe on observable is async. This handles
    // a quirk in the SDK where on/once callbacks can happen
    // synchronously.
    delay(0));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BlcmF0b3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy9uZ2ZpcmUvZGF0YWJhc2Uvc3JjL29wZXJhdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ2hDLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQWUsT0FBTyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFHeEQ7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFNBQVMsQ0FBQyxLQUFZO0lBQ3BDLE9BQU8sSUFBSSxVQUFVLENBQWUsQ0FBQyxVQUFVLEVBQUUsRUFBRTtRQUNqRCxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQ3pCLEtBQUssRUFDTCxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFDdkMsVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQ2xDLENBQUM7UUFDRixPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUMsSUFBSTtJQUNILHlEQUF5RDtJQUN6RCx3REFBd0Q7SUFDeEQsaUJBQWlCO0lBQ2pCLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FDWCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQge2RlbGF5fSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge0RhdGFTbmFwc2hvdCwgb25WYWx1ZX0gZnJvbSAnZmlyZWJhc2UvZGF0YWJhc2UnO1xuaW1wb3J0IHR5cGUge1F1ZXJ5fSBmcm9tICdmaXJlYmFzZS9kYXRhYmFzZSc7XG5cbi8qKlxuICogQ3JlYXRlIGFuIG9ic2VydmFibGUgZnJvbSBhIERhdGFiYXNlIFJlZmVyZW5jZSBvciBEYXRhYmFzZSBRdWVyeS5cbiAqIEBwYXJhbSBxdWVyeSBEYXRhYmFzZSBSZWZlcmVuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21RdWVyeShxdWVyeTogUXVlcnkpOiBPYnNlcnZhYmxlPERhdGFTbmFwc2hvdD4ge1xuICByZXR1cm4gbmV3IE9ic2VydmFibGU8RGF0YVNuYXBzaG90Pigoc3Vic2NyaWJlcikgPT4ge1xuICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gb25WYWx1ZShcbiAgICAgIHF1ZXJ5LFxuICAgICAgKHNuYXBzaG90KSA9PiBzdWJzY3JpYmVyLm5leHQoc25hcHNob3QpLFxuICAgICAgc3Vic2NyaWJlci5lcnJvci5iaW5kKHN1YnNjcmliZXIpLFxuICAgICk7XG4gICAgcmV0dXJuIHsgdW5zdWJzY3JpYmUgfTtcbiAgfSkucGlwZShcbiAgICAgIC8vIEVuc3VyZXMgc3Vic2NyaWJlIG9uIG9ic2VydmFibGUgaXMgYXN5bmMuIFRoaXMgaGFuZGxlc1xuICAgICAgLy8gYSBxdWlyayBpbiB0aGUgU0RLIHdoZXJlIG9uL29uY2UgY2FsbGJhY2tzIGNhbiBoYXBwZW5cbiAgICAgIC8vIHN5bmNocm9ub3VzbHkuXG4gICAgICBkZWxheSgwKVxuICApO1xufSJdfQ==